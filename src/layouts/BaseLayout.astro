---
import "../styles/global.css";
import GetInTouchModal from "../components/GetInTouchModal.astro";

const {
  title = "Berrystock Solutions",
  description = "Cloud solutions, ERP and CRM integration, AI automation, and real estate systems.",
} = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://berrystocksolutions.co.uk" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
  </head>

  <body>
    <nav>
      <div class="container inner">
        <a class="brand" href="/">
          <img src="/assets/brand-mark.jpg" alt="Berrystock Solutions" />
          <span>Berrystock Solutions</span>
        </a>
        <div class="navlinks">
          <a href="/services">Services</a>
          <button class="nav-cta" type="button" data-modal-open>
            Get in Touch &rsaquo;
          </button>
        </div>
      </div>
    </nav>

    <main><slot /></main>

    <footer class="footer">
      <div class="container">
        <div class="footer-inner">
          <span>© {new Date().getFullYear()} Berrystock Solutions · <a href="mailto:enquiries@berrystocksolutions.co.uk">enquiries@berrystocksolutions.co.uk</a></span>
          <div class="footer-links">
            <a href="/services">Services</a>
            <a href="/contact">Contact</a>
            <a href="https://www.linkedin.com/in/berkeleyo/" target="_blank" rel="noopener">LinkedIn</a>
          </div>
        </div>
      </div>
    </footer>

    <GetInTouchModal />

    <script>
      // ── Modal ──
      const dlg = document.getElementById("getInTouchModal") as HTMLDialogElement | null;
      function openModal() { dlg?.showModal?.() ?? dlg?.setAttribute("open","true"); }
      function closeModal() { dlg?.close?.(); dlg?.removeAttribute("open"); }

      document.querySelectorAll("[data-modal-open]").forEach(b => b.addEventListener("click", openModal));
      dlg?.querySelector("[data-modal-close]")?.addEventListener("click", closeModal);
      dlg?.addEventListener("click", (e) => {
        const r = dlg.querySelector(".bs-modal__card")?.getBoundingClientRect();
        if (r && (e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom)) closeModal();
      });

      // ── Scroll reveal ──
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });

      // Stagger children inside reveal containers
      document.querySelectorAll(".reveal").forEach((el, i) => {
        (el as HTMLElement).style.transitionDelay = `${(i % 6) * 60}ms`;
        observer.observe(el);
      });
    </script>
  </body>
</html>
